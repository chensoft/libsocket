language: cpp

matrix:
  include:
    - os: linux
      dist: trusty
      sudo: required
      addons:
        apt:
          sources:
            - ubuntu-toolchain-r-test
          packages:
            - gcc-4.9
            - g++-4.9
      install:
        # gcc 4.9
        - export CC=gcc-4.9
        - export CXX=g++-4.9
        # for code coverage
        - cd ${TRAVIS_BUILD_DIR}
        - wget http://ftp.de.debian.org/debian/pool/main/l/lcov/lcov_1.11.orig.tar.gz
        - tar xf lcov_1.11.orig.tar.gz
        - sudo make -C lcov-1.11/ install
        - gem install coveralls-lcov
        - lcov --version
      before_script:
        # for code coverage
        - cd ${TRAVIS_BUILD_DIR}
        - lcov --directory . --zerocounters
      after_success:
        # for code coverage
        - cd ${TRAVIS_BUILD_DIR}
        - lcov --directory . --capture --output-file coverage.info
        - lcov --remove coverage.info '/usr/*' 'googletest/*' --output-file coverage.info
        - lcov --list coverage.info
        - coveralls-lcov --repo-token ${COVERALLS_TOKEN} coverage.info
      script:
        - cd test
        - mkdir build
        - cd build
        - cmake -DLIBCHEN_TEST_CODE_COVERAGE=ON ..
        - make
        - ./test_libchen --data=../data

    - os: osx
      osx_image: xcode7
      install:
        - brew install cmake
      script:
        - cd test
        - mkdir build
        - cd build
        - cmake -G Xcode ..
        - xcodebuild -target test_libchen -project test_libchen.xcodeproj -configuration Release
        - Release/test_libchen --data=../data